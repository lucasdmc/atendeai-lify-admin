# PreservaÃ§Ã£o de Comportamento das Features

## ğŸ¯ PrincÃ­pio Fundamental
**Todas as alteraÃ§Ãµes devem visar manter o comportamento das features do sistema, a nÃ£o ser que seja explicitamente sugerido a alteraÃ§Ã£o da feature.**

## âœ… Comportamentos que DEVEM ser preservados:

### 1. **Sistema de Agendamentos**
- [Agendamentos.tsx](mdc:src/pages/Agendamentos.tsx) - Interface de agendamentos
- [appointmentService.ts](mdc:src/services/appointmentService.ts) - LÃ³gica de agendamentos
- CalendÃ¡rio funcional com visualizaÃ§Ã£o de eventos
- CriaÃ§Ã£o, ediÃ§Ã£o e exclusÃ£o de agendamentos
- IntegraÃ§Ã£o com Google Calendar

### 2. **Sistema de UsuÃ¡rios e PermissÃµes**
- [Auth.tsx](mdc:src/pages/Auth.tsx) - AutenticaÃ§Ã£o
- [users/](mdc:src/components/users/) - GestÃ£o de usuÃ¡rios
- Roles e permissÃµes baseadas em RLS do Supabase
- Perfis de usuÃ¡rio (admin_lify, admin_clinic, etc.)

### 3. **Sistema de ClÃ­nicas**
- [clinics/](mdc:src/components/clinics/) - GestÃ£o de clÃ­nicas
- [ClinicContext.tsx](mdc:src/contexts/ClinicContext.tsx) - Contexto de clÃ­nicas
- AssociaÃ§Ã£o de usuÃ¡rios com clÃ­nicas
- CRUD completo de clÃ­nicas

### 4. **Sistema de Conversas e Chat**
- [conversations/](mdc:src/components/conversations/) - Interface de conversas
- [conversation/](mdc:src/components/conversation/) - Chat individual
- HistÃ³rico de mensagens
- IntegraÃ§Ã£o com IA para respostas

### 5. **Sistema de Agentes WhatsApp**
- [agentes/](mdc:src/components/agentes/) - GestÃ£o de agentes
- [whatsapp/](mdc:src/components/whatsapp/) - Interface WhatsApp
- ConexÃ£o e desconexÃ£o de agentes
- QR Code para autenticaÃ§Ã£o
- Envio e recebimento de mensagens

### 6. **Sistema de IA e ContextualizaÃ§Ã£o**
- [contextualization/](mdc:src/components/contextualization/) - Chat contextualizado
- [ai/](mdc:src/services/ai/) - ServiÃ§os de IA
- MemÃ³ria de conversas
- Reconhecimento de intenÃ§Ãµes
- IntegraÃ§Ã£o com GPT-4

### 7. **Backend e APIs**
- [server.js](mdc:server.js) - Servidor WhatsApp
- [supabase/functions/](mdc:supabase/functions/) - Edge Functions
- Endpoints REST para WhatsApp
- Webhooks para processamento de mensagens
- IntegraÃ§Ã£o com Supabase

## ğŸ”„ Processo de ConfirmaÃ§Ã£o de MudanÃ§as

### Antes de qualquer alteraÃ§Ã£o:
1. **Identificar a feature afetada**
2. **Documentar o comportamento atual**
3. **Confirmar se a mudanÃ§a Ã© necessÃ¡ria**
4. **Testar apÃ³s a implementaÃ§Ã£o**

### Para mudanÃ§as de comportamento:
1. **Solicitar confirmaÃ§Ã£o explÃ­cita do usuÃ¡rio**
2. **Explicar o impacto da mudanÃ§a**
3. **Oferecer alternativas que preservem o comportamento**
4. **Implementar apenas apÃ³s aprovaÃ§Ã£o**

## âš ï¸ Ãreas CrÃ­ticas (NÃƒO alterar sem confirmaÃ§Ã£o):

### Estrutura de Dados
- Tabelas do Supabase
- Schemas de banco de dados
- Relacionamentos entre entidades

### APIs e Endpoints
- URLs de endpoints
- Estrutura de respostas
- AutenticaÃ§Ã£o e autorizaÃ§Ã£o

### IntegraÃ§Ãµes Externas
- Google Calendar
- WhatsApp Web.js
- OpenAI GPT-4
- Supabase

### Fluxo de UsuÃ¡rio
- Fluxo de autenticaÃ§Ã£o
- NavegaÃ§Ã£o entre pÃ¡ginas
- Estados de loading e erro
- Feedback visual

## ğŸ“‹ Checklist de PreservaÃ§Ã£o

Antes de implementar qualquer mudanÃ§a:

- [ ] A mudanÃ§a Ã© necessÃ¡ria para correÃ§Ã£o de bug?
- [ ] A mudanÃ§a foi explicitamente solicitada?
- [ ] O comportamento atual foi documentado?
- [ ] A mudanÃ§a foi testada em ambiente isolado?
- [ ] O usuÃ¡rio foi consultado sobre mudanÃ§as de comportamento?
- [ ] Existe rollback plan se necessÃ¡rio?

## ğŸ¯ Exemplo de Boa PrÃ¡tica

**âŒ Ruim:**
```
// Alterar endpoint sem consultar
app.post('/api/whatsapp/send-message', (req, res) => {
  // MudanÃ§a que quebra compatibilidade
});
```

**âœ… Bom:**
```
// Confirmar mudanÃ§a antes de implementar
// "Deseja alterar o endpoint /api/whatsapp/send-message para incluir agentId?"
// Se sim, implementar com backward compatibility
app.post('/api/whatsapp/send-message', (req, res) => {
  // Manter compatibilidade com versÃ£o anterior
  const { agentId, to, message } = req.body;
  // Implementar nova lÃ³gica
});
```

## ğŸ“ ComunicaÃ§Ã£o

**Sempre perguntar antes de alterar comportamentos:**
- "Esta mudanÃ§a pode afetar o comportamento atual. Confirma?"
- "Deseja preservar a compatibilidade com versÃµes anteriores?"
- "Esta alteraÃ§Ã£o pode quebrar integraÃ§Ãµes existentes. Prossegue?"

**Documentar mudanÃ§as:**
- Explicar o que mudou
- Por que mudou
- Como testar
- Impacto em outras features
description:
globs:
alwaysApply: false
---
